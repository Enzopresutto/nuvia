<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NUVIA ‚Äî L'intelligence qui trouve le meilleur pour toi</title>
<meta name="description" content="NUVIA - Prototype e-commerce IA. Compare prix & qualit√©. Prototype local demo."/>
<style>
  :root{
    --bg:#ffffff;
    --muted:#6b7280;
    --violet-1:#5a4bff;
    --violet-2:#8a7dff;
    --accent: linear-gradient(135deg,var(--violet-1),var(--violet-2));
    --card:#ffffff;
    --shadow: 0 8px 30px rgba(17,24,39,0.08);
    --radius:14px;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:#0f1724;line-height:1.4;-webkit-font-smoothing:antialiased}
  header{display:flex;align-items:center;justify-content:space-between;padding:18px 28px;background:linear-gradient(180deg,#ffffff 0%, #f7f8fc 100%);position:sticky;top:0;z-index:1000;border-bottom:1px solid #eef2ff}
  .brand{display:flex;align-items:center;gap:14px}
  .mark{width:44px;height:44px;border-radius:10px;background:var(--accent);display:flex;align-items:center;justify-content:center;color:white;font-weight:800;font-size:18px;box-shadow:0 6px 18px rgba(90,75,255,0.18)}
  .brand h1{font-size:18px;margin:0}
  .slogan{font-size:12px;color:var(--muted);margin-top:2px}
  nav{display:flex;gap:18px;align-items:center}
  nav a{color:#111827;text-decoration:none;font-weight:600}
  nav a.small{color:var(--muted);font-weight:500;font-size:14px}
  .searchbar{flex:1;margin:0 20px;display:flex;align-items:center;gap:8px}
  .searchbar input{flex:1;padding:12px 14px;border-radius:12px;border:1px solid #e6e9ff;outline:none}
  .searchbar button{padding:10px 14px;border-radius:10px;border:none;background:var(--violet-1);color:white;font-weight:700;cursor:pointer}
  .cta{background:var(--violet-1);color:white;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
  .container{max-width:1200px;margin:20px auto;padding:0 18px}
  .hero{display:flex;gap:20px;align-items:center;background:linear-gradient(135deg,var(--violet-1),var(--violet-2));color:white;padding:34px;border-radius:18px;box-shadow:var(--shadow)}
  .hero-left{flex:1}
  .hero h2{font-size:28px;margin:0 0 8px}
  .hero p{margin:0 0 16px;color:rgba(255,255,255,0.9)}
  .hero .actions{display:flex;gap:12px}
  .card{background:var(--card);padding:16px;border-radius:14px;box-shadow:var(--shadow)}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:18px;margin-top:18px}
  .category-grid{display:flex;gap:12px;margin-top:16px;flex-wrap:wrap}
  .category{background:white;padding:12px;border-radius:10px;min-width:140px;text-align:center;box-shadow:0 6px 18px rgba(90,75,255,0.06)}
  .section-title{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
  .products{display:grid;grid-template-columns:repeat(4,1fr);gap:18px}
  .product{background:white;border-radius:12px;overflow:hidden;box-shadow:0 10px 30px rgba(17,24,39,0.06);display:flex;flex-direction:column}
  .product img{width:100%;height:170px;object-fit:cover}
  .product .info{padding:12px;flex:1;display:flex;flex-direction:column;gap:8px}
  .product h4{margin:0;font-size:16px}
  .meta{display:flex;justify-content:space-between;align-items:center;font-size:14px;color:var(--muted)}
  .price{font-weight:800;color:var(--violet-1)}
  .btn-sm{padding:8px 10px;border-radius:10px;border:none;cursor:pointer}
  .btn-buy{background:linear-gradient(90deg,var(--violet-1),var(--violet-2));color:white;font-weight:700}
  .btn-ghost{background:transparent;border:1px solid #eef2ff;color:var(--violet-1);font-weight:700}
  .promo{display:flex;gap:12px;align-items:center}
  .big-promo{background:linear-gradient(90deg,rgba(255,255,255,0.06),rgba(255,255,255,0.03));padding:18px;border-radius:12px;display:flex;gap:16px;align-items:center}
  .small{font-size:13px;color:var(--muted)}
  .footer{margin-top:28px;padding:28px;background:#0f1724;color:#cbd5e1;border-radius:12px}
  .footer-columns{display:flex;gap:24px;flex-wrap:wrap}
  .footer .col h5{color:white;margin-bottom:8px}
  .legal{font-size:12px;color:#94a3b8;margin-top:12px}
  /* cart */
  .cart-btn{position:relative}
  .cart-count{position:absolute;right:-8px;top:-8px;background:#ff3b3b;color:white;border-radius:999px;padding:3px 7px;font-size:12px}
  /* modal */
  .modal-bg{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:none;align-items:center;justify-content:center;z-index:2000}
  .modal{background:white;border-radius:14px;padding:18px;width:92%;max-width:940px;max-height:90vh;overflow:auto}
  .row{display:flex;gap:12px;align-items:center}
  .col{flex:1}
  .product-img-large{width:320px;height:320px;object-fit:cover;border-radius:10px}
  .badge{background:#f0f9ff;color:#0369a1;padding:6px 8px;border-radius:999px;font-weight:700}
  /* responsive */
  @media (max-width:1000px){.grid,.products{grid-template-columns:repeat(2,1fr)}.product-img-large{width:260px;height:260px}}
  @media (max-width:640px){header{flex-wrap:wrap}.searchbar{order:3;width:100%;margin:14px 0}.grid,.products{grid-template-columns:1fr}.hero{flex-direction:column;align-items:flex-start}}
</style>
</head>
<body>

<header>
  <div class="brand">
    <div class="mark">N</div>
    <div>
      <h1>NUVIA</h1>
      <div class="slogan">L'intelligence qui trouve le meilleur pour toi</div>
    </div>
  </div>

  <div class="searchbar">
    <input id="globalSearch" placeholder="Rechercher un produit, ex: 'casque audio'"/>
    <button id="searchBtn">Rechercher</button>
  </div>

  <nav>
    <a href="#hero">Accueil</a>
    <a href="#productsSection" class="small">Produits</a>
    <a href="#offersSection" class="small">Offres</a>
    <a href="#aboutSection" class="small">√Ä propos</a>
    <button class="cta cart-btn" id="openCart">Panier <span class="cart-count" id="cartCount" style="display:none">0</span></button>
    <button class="cta" id="openAI">ü§ñ Conseiller IA</button>
  </nav>
</header>

<main class="container">
  <!-- HERO -->
  <section class="hero">
    <div class="hero-left">
      <h2>NUVIA ‚Äî Le futur du shopping : rappelez‚Äëvous, comparez, achetez malin.</h2>
      <p>Notre IA compare les prix, filtre les faux avis et vous propose le meilleur produit selon votre budget et vos besoins ‚Äî en un clic.</p>
      <div class="actions">
        <button class="btn-sm btn-buy" id="ctaStart">Essayez le conseiller IA</button>
        <button class="btn-sm btn-ghost" onclick="document.getElementById('productsSection').scrollIntoView()">Voir produits</button>
      </div>

      <div style="margin-top:18px;color:rgba(255,255,255,0.9)">
        <div style="display:flex;gap:12px;align-items:center;margin-top:12px">
          <div class="badge">Garanties NUVIA</div>
          <div class="small">Comparaison instantan√©e ‚Ä¢ Recommandations personnelles ‚Ä¢ Livraison rapide</div>
        </div>
      </div>
    </div>

    <div style="width:420px">
      <div class="big-promo">
        <div style="flex:1">
          <h3 style="margin:0">Offres exclusives</h3>
          <div class="small">R√©serv√©es aux visiteurs NUVIA ‚Äî √©conomies imm√©diates</div>
        </div>
        <div><img src="https://images.unsplash.com/photo-1600078627898-8b41f4f8f8d3?auto=format&fit=crop&w=320&q=60" alt="promo" style="width:110px;border-radius:10px"></div>
      </div>
    </div>
  </section>

  <!-- categories -->
  <section style="margin-top:20px">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 style="margin:0">Cat√©gories populaires</h3>
      <div style="color:var(--muted)">S√©lectionn√© pour toi</div>
    </div>
    <div class="category-grid" style="margin-top:12px">
      <div class="category">Tech & Gadgets</div>
      <div class="category">Maison & Ambiance</div>
      <div class="category">Fitness & Bien-√™tre</div>
      <div class="category">Gaming</div>
      <div class="category">Lifestyle</div>
      <div class="category">Offres du jour</div>
    </div>
  </section>

  <!-- products -->
  <section class="section" id="productsSection">
    <div class="section-title">
      <h2>Produits populaires</h2>
      <div>
        Trier : 
        <select id="sortSelect">
          <option value="featured">Pertinence</option>
          <option value="price-asc">Prix : bas ‚Üí haut</option>
          <option value="price-desc">Prix : haut ‚Üí bas</option>
          <option value="rating">Meilleure note</option>
        </select>
      </div>
    </div>

    <div class="products" id="productGrid">
      <!-- JS inject products -->
    </div>
  </section>

  <!-- offers -->
  <section class="section" id="offersSection">
    <div class="section-title">
      <h2>Offres sp√©ciales</h2>
      <div class="small">Les promos du moment</div>
    </div>
    <div class="products" id="offerGrid"></div>
  </section>

  <!-- about / legal -->
  <section class="section" id="aboutSection">
    <h2>√Ä propos & Mentions l√©gales</h2>
    <p>NUVIA est un prototype d√©monstration. Ce site n'est pas une boutique r√©elle ‚Äî il montre comment un site e‚Äëcommerce pilot√© par IA pourrait fonctionner. Les images sont utilis√©es √† des fins de d√©monstration.</p>

    <div style="text-align:left;margin-top:18px;max-width:900px;margin-left:auto;margin-right:auto">
      <h3>Mentions l√©gales (exemple)</h3>
      <p><strong>NUVIA Sarl</strong><br>Si√®ge : 10 rue Exemple, 75000 Paris<br>SIRET : 000 000 000 00000</p>

      <h3>CGV & Politique de confidentialit√© (exemple)</h3>
      <p>Les informations personnelles ne sont pas collect√©es dans ce prototype. Pour un site r√©el, la RGPD, gestion des paiements s√©curis√©s et conditions de vente s'appliqueraient.</p>
    </div>
  </section>

  <div class="footer">
    <div class="footer-columns">
      <div class="col">
        <h5>NUVIA</h5>
        <div class="small">L'intelligence qui trouve le meilleur pour toi.</div>
      </div>
      <div class="col">
        <h5>Produits</h5>
        <div class="small">Tech ‚Ä¢ Maison ‚Ä¢ Fitness ‚Ä¢ Lifestyle</div>
      </div>
      <div class="col">
        <h5>Aide</h5>
        <div class="small">Contact ‚Ä¢ FAQ ‚Ä¢ Livraison</div>
      </div>
      <div class="col">
        <h5>Entreprise</h5>
        <div class="small">Mentions l√©gales ‚Ä¢ CGV ‚Ä¢ Partenaires</div>
      </div>
    </div>
    <div class="legal">¬© 2025 NUVIA ‚Äî Prototype. Tous droits r√©serv√©s (d√©mo).</div>
  </div>
</main>

<!-- MODALS: cart + product + AI -->
<div class="modal-bg" id="modalBg">
  <div class="modal" id="modalContent"></div>
</div>

<!-- CART DATA (client-side) -->
<script>
/* ---------------------------
   DATA: products & offers
   --------------------------- */
const PRODUCTS = [
  {id:1,title:'Casque Audio Sans Fil - HyperBass',price:59.99,rating:4.5,cat:'Tech',img:'https://images.unsplash.com/photo-1518440902107-0f4b0b6ef11d?auto=format&fit=crop&w=800&q=60',desc:'Casque Bluetooth avec annulation du bruit et 30h d‚Äôautonomie.'},
  {id:2,title:'Lampe LED Ambiance 16M',price:29.90,rating:4.6,cat:'Maison',img:'https://images.unsplash.com/photo-1524758631624-e2822e304c36?auto=format&fit=crop&w=800&q=60',desc:'Lampe connect√©e RGB pour chambre et streaming.'},
  {id:3,title:'Montre Connect√©e Fit+',price:49.90,rating:4.3,cat:'Fitness',img:'https://images.unsplash.com/photo-1519741499645-9e65c4b0d3f0?auto=format&fit=crop&w=800&q=60',desc:'Suivi du sommeil, activit√©, notifications et autonomie 7j.'},
  {id:4,title:'Mini Projecteur Portable',price:89.00,rating:4.4,cat:'Tech',img:'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?auto=format&fit=crop&w=800&q=60',desc:'Projecteur HD compact pour soir√©es movie.'},
  {id:5,title:'Batterie Externe 20000mAh',price:29.99,rating:4.5,cat:'Tech',img:'https://images.unsplash.com/photo-1545239351-1141bd82e8a6?auto=format&fit=crop&w=800&q=60',desc:'Charge rapide 3 ports, compatible PD.'},
  {id:6,title:'Coussin de Massage Portable',price:39.99,rating:4.6,cat:'Bien-√™tre',img:'https://images.unsplash.com/photo-1541698444083-023c97d3f4b6?auto=format&fit=crop&w=800&q=60',desc:'Soulage tensions cervicales et dos, format compact.'},
  {id:7,title:'Echo Dot (5·µâ gen)',price:59.99,rating:4.7,cat:'Tech',img:'https://m.media-amazon.com/images/I/61u48FEs4PL._AC_SL1000_.jpg',desc:'Assistant vocal compact pour maison connect√©e.'},
  {id:8,title:'AirPods Pro (2·µâ gen)',price:249.00,rating:4.8,cat:'Tech',img:'https://m.media-amazon.com/images/I/71bhWgQK-cL._AC_SL1500_.jpg',desc:'Casque intra-auriculaire avec ANC adaptatif.'},
  {id:9,title:'Support Smartphone Magn√©tique',price:12.50,rating:4.1,cat:'Lifestyle',img:'https://images.unsplash.com/photo-1585386959984-a4155223f1c8?auto=format&fit=crop&w=800&q=60',desc:'Support magn√©tique √† coller pour bureau ou voiture.'},
  {id:10,title:'Bande de R√©sistance Fitness',price:14.99,rating:4.2,cat:'Fitness',img:'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?auto=format&fit=crop&w=800&q=60',desc:'Set de 3 bandes pour training et mobilit√©.'},
  {id:11,title:'Lampe Simulateur d\'Aube',price:49.90,rating:4.4,cat:'Maison',img:'https://images.unsplash.com/photo-1515879218367-8466d910aaa4?auto=format&fit=crop&w=800&q=60',desc:'R√©veil lumineux pour cycle de sommeil naturel.'},
  {id:12,title:'Cafeti√®re Portable',price:39.50,rating:4.3,cat:'Maison',img:'https://images.unsplash.com/photo-1504252060327-8a7f1b6d0e2e?auto=format&fit=crop&w=800&q=60',desc:'Cafeti√®re nomade pour voyage et bureau.'}
];

const OFFERS = [
  {id:101,title:'Pack Home Cinema (Projecteur + Son)',price:149.00,rating:4.5,img:'https://images.unsplash.com/photo-1546443046-ed1ce6ffd9d2?auto=format&fit=crop&w=800&q=60',desc:'√âconomisez 30% sur le pack.'},
  {id:102,title:'Pack Fitness D√©butant',price:39.99,rating:4.6,img:'https://images.unsplash.com/photo-1599058917215-7a7fa1f2b9d2?auto=format&fit=crop&w=800&q=60',desc:'√âlastiques + guide d‚Äôentra√Ænement.'},
  {id:103,title:'Offre √âtudiant - Casque + Lampe',price:69.99,rating:4.4,img:'https://images.unsplash.com/photo-1540574163026-643ea20ade25?auto=format&fit=crop&w=800&q=60',desc:'Prix sp√©cial √©tudiant.'}
];

/* ---------------------------
   APP STATE
   --------------------------- */
let CART = [];

/* ---------------------------
   UI: render functions
   --------------------------- */
function formatPrice(p){ return p.toFixed(2) + ' ‚Ç¨'; }

function renderProducts(list=PRODUCTS){
  const grid = document.getElementById('productGrid');
  grid.innerHTML = '';
  list.forEach(p=>{
    const el = document.createElement('div'); el.className='product';
    el.innerHTML = `
      <img src="${p.img}" alt="${escapeHtml(p.title)}">
      <div class="info">
        <h4>${escapeHtml(p.title)}</h4>
        <div class="meta"><div class="small">${escapeHtml(p.cat)}</div><div class="price">${formatPrice(p.price)}</div></div>
        <div style="display:flex;gap:8px;align-items:center;margin-top:auto">
          <button class="btn-sm btn-ghost" onclick="openProduct(${p.id})">Voir</button>
          <button class="btn-sm btn-buy" onclick="addToCart(${p.id})">Ajouter</button>
        </div>
      </div>
    `;
    grid.appendChild(el);
  });
}

function renderOffers(){
  const grid = document.getElementById('offerGrid');
  grid.innerHTML='';
  OFFERS.forEach(p=>{
    const el = document.createElement('div'); el.className='product';
    el.innerHTML=`
      <img src="${p.img}" alt="${escapeHtml(p.title)}">
      <div class="info">
        <h4>${escapeHtml(p.title)}</h4>
        <div class="meta"><div class="small">Offre</div><div class="price">${formatPrice(p.price)}</div></div>
        <div style="margin-top:auto"><button class="btn-sm btn-buy" onclick="openOffer(${p.id})">Voir l'offre</button></div>
      </div>
    `;
    grid.appendChild(el);
  });
}

/* ---------------------------
   MODALS: product, offer, cart, ai
   --------------------------- */
const modalBg = document.getElementById('modalBg');
const modalContent = document.getElementById('modalContent');

function showModal(html){
  modalContent.innerHTML = html;
  modalBg.style.display = 'flex';
  window.scrollTo({top:0,behavior:'smooth'});
}
function closeModal(){ modalBg.style.display='none'; modalContent.innerHTML=''; }

modalBg.addEventListener('click', (e)=>{ if(e.target===modalBg) closeModal(); });

function openProduct(id){
  const p = PRODUCTS.find(x=>x.id===id);
  if(!p) return;
  const html = `
    <div style="display:flex;gap:16px;flex-wrap:wrap">
      <div style="flex:0 0 320px"><img class="product-img-large" src="${p.img}" alt="${escapeHtml(p.title)}"></div>
      <div style="flex:1">
        <h2>${escapeHtml(p.title)}</h2>
        <div style="display:flex;gap:12px;align-items:center;margin:8px 0">
          <div class="badge">Note: ${p.rating} ‚≠ê</div>
          <div class="small">Cat√©gorie: ${escapeHtml(p.cat)}</div>
        </div>
        <h3 style="color:var(--violet-1)">${formatPrice(p.price)}</h3>
        <p style="margin-top:12px">${escapeHtml(p.desc)}</p>
        <div style="margin-top:16px;display:flex;gap:10px">
          <button class="btn-sm btn-buy" onclick="addToCart(${p.id});">Ajouter au panier</button>
          <button class="btn-sm btn-ghost" onclick="closeModal()">Fermer</button>
        </div>
      </div>
    </div>
  `;
  showModal(html);
}

function openOffer(id){
  const p = OFFERS.find(x=>x.id===id);
  if(!p) return;
  const html = `
    <div style="display:flex;gap:16px;flex-wrap:wrap">
      <div style="flex:0 0 300px"><img class="product-img-large" src="${p.img}" alt="${escapeHtml(p.title)}"></div>
      <div style="flex:1">
        <h2>${escapeHtml(p.title)}</h2>
        <h3 style="color:var(--violet-1)">${formatPrice(p.price)}</h3>
        <p style="margin-top:12px">${escapeHtml(p.desc)}</p>
        <div style="margin-top:16px"><button class="btn-sm btn-buy" onclick="closeModal();alert('Simulation: offre ajout√©e au panier.');">Profiter</button></div>
      </div>
    </div>
  `;
  showModal(html);
}

/* ---------------------------
   CART
   --------------------------- */
function addToCart(id){
  const p = PRODUCTS.find(x=>x.id===id);
  if(!p) return;
  const existing = CART.find(c=>c.id===id);
  if(existing) existing.qty += 1;
  else CART.push({id:p.id,title:p.title,price:p.price,qty:1});
  updateCartUI();
  toast('Produit ajout√© au panier');
}

function updateCartUI(){
  const count = CART.reduce((s,i)=>s+i.qty,0);
  const el = document.getElementById('cartCount');
  if(count>0){ el.style.display='inline-block'; el.innerText = count; } else el.style.display='none';
}

document.getElementById('openCart').addEventListener('click', ()=> {
  const html = renderCartHtml();
  showModal(html);
});

function renderCartHtml(){
  if(CART.length===0) return `<h2>Panier</h2><p>Ton panier est vide.</p><div style="margin-top:16px"><button class="btn-sm btn-ghost" onclick="closeModal()">Fermer</button></div>`;
  let total = 0;
  let itemsHtml = CART.map(item=>{
    const line = item.price * item.qty; total += line;
    return `<div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid #f1f5f9">
      <div><strong>${escapeHtml(item.title)}</strong><div class="small">${item.qty} x ${formatPrice(item.price)}</div></div>
      <div style="text-align:right">
        <div>${formatPrice(line)}</div>
        <div style="margin-top:8px">
          <button class="btn-sm btn-ghost" onclick="changeQty(${item.id}, -1)">-</button>
          <button class="btn-sm btn-ghost" onclick="changeQty(${item.id}, +1)">+</button>
          <button class="btn-sm" style="background:#ff3b3b;color:white;border-radius:8px;margin-left:8px" onclick="removeItem(${item.id})">Suppr</button>
        </div>
      </div>
    </div>`;
  }).join('');
  const checkoutHtml = `
    <h2>Ton panier</h2>
    ${itemsHtml}
    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
      <strong>Total</strong><div style="font-size:18px">${formatPrice(total)}</div>
    </div>
    <div style="margin-top:16px;display:flex;gap:10px">
      <button class="btn-sm btn-buy" onclick="simulateCheckout(${total})">Passer √† la caisse</button>
      <button class="btn-sm btn-ghost" onclick="closeModal()">Continuer mes achats</button>
    </div>
  `;
  return checkoutHtml;
}

function changeQty(id, delta){
  const item = CART.find(c=>c.id===id);
  if(!item) return;
  item.qty += delta;
  if(item.qty <= 0) CART = CART.filter(c=>c.id!==id);
  updateCartUI();
  const html = renderCartHtml(); showModal(html);
}
function removeItem(id){ CART = CART.filter(c=>c.id!==id); updateCartUI(); const html = renderCartHtml(); showModal(html); }

function simulateCheckout(total){
  closeModal();
  alert('Simulation de paiement: Montant ' + formatPrice(total) + '. (Ce prototype ne traite pas de paiements r√©els.)');
  CART = []; updateCartUI();
}

/* ---------------------------
   SEARCH & SORT
   --------------------------- */
document.getElementById('searchBtn').addEventListener('click', ()=> {
  const q = document.getElementById('globalSearch').value.trim().toLowerCase();
  if(!q) { renderProducts(PRODUCTS); return; }
  const found = PRODUCTS.filter(p => (p.title + ' ' + (p.desc||'')).toLowerCase().includes(q) || p.cat.toLowerCase().includes(q));
  renderProducts(found);
});

document.getElementById('sortSelect').addEventListener('change', (e)=>{
  const m = e.target.value;
  let sorted = [...PRODUCTS];
  if(m==='price-asc') sorted.sort((a,b)=>a.price-b.price);
  else if(m==='price-desc') sorted.sort((a,b)=>b.price-a.price);
  else if(m==='rating') sorted.sort((a,b)=>b.rating-a.rating);
  renderProducts(sorted);
});

/* ---------------------------
   SIMPLE AI: recommends top 3
   (client-side heuristic)
   --------------------------- */
document.getElementById('openAI').addEventListener('click', openAiPanel);
document.getElementById('ctaStart').addEventListener('click', openAiPanel);

function openAiPanel(){
  const html = `
    <div>
      <h2>Conseiller IA NUVIA</h2>
      <p class="small">Tape ce que tu veux et l'IA te propose les 3 meilleures options (prix & fiabilit√©).</p>
      <div style="margin-top:12px">
        <input id="aiInput" placeholder="Ex : casque audio pas cher" style="width:100%;padding:10px;border-radius:10px;border:1px solid #e6e9ff"/>
        <div style="display:flex;gap:8px;margin-top:8px">
          <select id="aiStrategy" style="padding:8px;border-radius:8px;border:1px solid #eef2ff">
            <option value="best">Meilleur rapport qualit√©/prix</option>
            <option value="cheap">Le moins cher</option>
            <option value="fast">Livraison rapide (simul√©e)</option>
            <option value="pro">Qualit√© / note</option>
          </select>
          <input id="aiBudget" placeholder="Budget ‚Ç¨ (facultatif)" style="padding:8px;border-radius:8px;border:1px solid #eef2ff"/>
          <button class="btn-sm btn-buy" onclick="runAi()">Lancer IA</button>
        </div>
        <pre id="aiOut" style="background:#f8fafc;padding:10px;border-radius:8px;margin-top:12px;min-height:80px"></pre>
      </div>
      <div style="margin-top:12px"><button class="btn-sm btn-ghost" onclick="closeModal()">Fermer</button></div>
    </div>
  `;
  showModal(html);
}

function runAi(){
  const q = document.getElementById('aiInput').value.trim().toLowerCase();
  const strat = document.getElementById('aiStrategy').value;
  const budgetStr = document.getElementById('aiBudget').value.trim();
  const budget = parseFloat(budgetStr) || null;
  // filter by query
  let candidates = PRODUCTS.filter(p => (p.title + ' ' + (p.desc||'') + ' ' + p.cat).toLowerCase().includes(q) || q==='');
  if(candidates.length===0) candidates = PRODUCTS.slice();
  // scoring
  const scored = candidates.map(p=>{
    let score = p.rating * 20; // rating base
    // price factor
    if(budget){
      const diff = Math.abs(p.price - budget);
      score -= Math.min(diff, budget) / Math.max(1,budget) * 10;
    }
    if(strat==='cheap') score += (50 - p.price); // reward cheap
    if(strat==='pro') score += p.rating * 10 + p.price/100;
    if(strat==='fast') score += 5; // placeholder
    // small penalty for very expensive (demo)
    if(p.price>500) score -= 20;
    return {...p,score};
  });
  scored.sort((a,b)=>b.score-a.score);
  const top = scored.slice(0,3);
  // output
  const out = document.getElementById('aiOut');
  let text = `Recommandations pour: "${q || 'tout'}" (strat√©gie: ${strat}${budget?(', budget: '+budget+'‚Ç¨'):''})\n\n`;
  top.forEach((p,i)=> text += `${i+1}. ${p.title} ‚Äî ${formatPrice(p.price)} ‚Äî Note: ${p.rating} ‚Äî Score IA: ${Math.round(p.score)}\n`);
  text += `\nConseil: Le #1 est g√©n√©ralement le meilleur √©quilibre prix/qualit√©.\n`;
  text += `\nTu peux ouvrir la fiche ou cliquer ‚ÄúAjouter au panier‚Äù depuis la page produit.`;
  out.innerText = text;

  // also show quick product cards under the AI panel
  const htmlCards = top.map(p=>`
    <div style="display:flex;gap:10px;align-items:center;padding:8px;border-radius:8px;background:#fff;margin-top:8px">
      <img src="${p.img}" style="width:80px;height:60px;object-fit:cover;border-radius:6px"/>
      <div style="flex:1">
        <div style="font-weight:700">${escapeHtml(p.title)}</div>
        <div style="color:${p.price>100? '#b91c1c':'#065f46'}">${formatPrice(p.price)}</div>
      </div>
      <div>
        <button class="btn-sm btn-buy" onclick="addToCart(${p.id});">Ajouter</button>
      </div>
    </div>
  `).join('');
  // append product cards
  document.getElementById('aiOut').innerHTML = out.innerText + '\n' + '\n' + '------\n'+ '\n' + 'Voir ci-dessous les options rapides.';
  // insert HTML after pre
  const pre = document.getElementById('aiOut');
  const parent = pre.parentNode;
  // remove existing quick list
  const old = document.getElementById('aiQuick');
  if(old) old.remove();
  const wrapper = document.createElement('div');
  wrapper.id = 'aiQuick';
  wrapper.innerHTML = htmlCards;
  parent.appendChild(wrapper);
}

/* ---------------------------
   UTILITIES
   --------------------------- */
function escapeHtml(str){ return (str+'').replace(/[&<>"']/g, (m)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

function toast(msg){
  // small temporary toast
  const t = document.createElement('div');
  t.style.position='fixed'; t.style.bottom='24px'; t.style.left='50%'; t.style.transform='translateX(-50%)'; t.style.background='#0f1724'; t.style.color='white'; t.style.padding='10px 14px'; t.style.borderRadius='10px'; t.style.zIndex=3000; t.style.boxShadow='0 10px 30px rgba(2,6,23,0.4)';
  t.innerText = msg; document.body.appendChild(t);
  setTimeout(()=>{ t.style.transition='all 0.3s'; t.style.opacity='0'; setTimeout(()=>t.remove(),300); },1500);
}

/* ---------------------------
   INIT render
   --------------------------- */
renderProducts(PRODUCTS);
renderOffers();

/* close modal on ESC */
document.addEventListener('keydown', (e)=> { if(e.key === 'Escape') closeModal(); });

</script>
</body>
</html>